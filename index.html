<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Makoi Motor Shop POS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #f3f4f6;
      color: #111827;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1f2937;
    }

    header span {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .grid {
      display: grid;
      grid-template-columns: 2fr 1.5fr;
      gap: 12px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #ffffff;
      border-radius: 10px;
      padding: 10px 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }

    .card h2 {
      font-size: 0.95rem;
      margin-bottom: 6px;
      color: #111827;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    @media (max-width: 900px) {
      .summary-cards {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .summary-card {
      background: #e5f0ff;
      border-radius: 8px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .summary-card span.label {
      font-size: 0.7rem;
      color: #4b5563;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .summary-card span.value {
      font-weight: 700;
      font-size: 0.9rem;
      color: #111827;
    }

    label {
      font-size: 0.75rem;
      color: #374151;
      display: block;
      margin-bottom: 2px;
    }

    input, select {
      width: 100%;
      padding: 5px 7px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 0.8rem;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
    }

    .row {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 6px;
      margin-bottom: 6px;
    }

    .row-4 {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 6px;
      margin-bottom: 6px;
    }

    .row-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      margin-bottom: 6px;
    }

    @media (max-width: 640px) {
      .row, .row-4, .row-3 {
        grid-template-columns: 1fr 1fr;
      }
    }

    button {
      border-radius: 6px;
      border: none;
      padding: 6px 10px;
      font-size: 0.8rem;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-danger {
      background: #dc2626;
      color: white;
    }

    .btn-xs {
      padding: 2px 6px;
      font-size: 0.7rem;
    }

    .btn-block {
      width: 100%;
    }

    .section-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
    }

    th, td {
      padding: 4px 5px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      background: #f3f4f6;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    /* ðŸ”¹ WINDOW STYLE INVENTORY LIST */
    .inventory-window {
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      overflow-y: auto;
      max-height: 220px;   /* dito para hindi na humaba ang list */
      background: #ffffff;
    }

    /* ðŸ”¹ WINDOW STYLE SALES & EXPENSES LISTS */
    .scroll-window {
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      overflow-y: auto;
      max-height: 220px;
      background: #ffffff;
    }

    .tiny-text {
      font-size: 0.7rem;
      color: #6b7280;
    }

    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .mt-2 { margin-top: 8px; }
    .mt-3 { margin-top: 12px; }
    .mb-1 { margin-bottom: 4px; }

    .badge {
      display: inline-block;
      padding: 1px 4px;
      border-radius: 999px;
      font-size: 0.65rem;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .text-right { text-align: right; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Makoi Motor Shop POS</h1>
        <span>Simple POS with backup, inventory, sales, and expenses</span>
      </div>
      <div class="tiny-text">
        Today: <span id="todayLabel"></span>
      </div>
    </header>

    <!-- SUMMARY -->
    <div class="summary-cards">
      <div class="summary-card">
        <span class="label">Sales Today</span>
        <span class="value" id="summarySales">â‚±0.00</span>
      </div>
      <div class="summary-card">
        <span class="label">Gross Profit Today</span>
        <span class="value" id="summaryProfit">â‚±0.00</span>
      </div>
      <div class="summary-card">
        <span class="label">Expenses Today</span>
        <span class="value" id="summaryExpenses">â‚±0.00</span>
      </div>
      <div class="summary-card">
        <span class="label">Net Profit Today</span>
        <span class="value" id="summaryNet">â‚±0.00</span>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT SIDE: SEARCH + INVENTORY -->
      <div class="left">
        <div class="card">
          <div class="section-title">Search Item</div>
          <div class="row-3">
            <div>
              <label for="searchInput">Search by name / storage</label>
              <input id="searchInput" type="text" placeholder="Halimbawa: spark plug, oil..." />
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn-secondary btn-block" type="button" onclick="clearSearch()">Clear Search</button>
            </div>
            <div class="tiny-text" style="align-self:flex-end;">
              Result shows: name, prices, profit &amp; storage
            </div>
          </div>
          <div class="inventory-window" id="searchWindow">
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Qty</th>
                  <th>Buy</th>
                  <th>Sell</th>
                  <th>Profit</th>
                  <th>Storage</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="searchResultsBody">
                <!-- search results -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="card mt-3">
          <div class="section-title">Inventory (Item Master)</div>
          <form id="inventoryForm" onsubmit="handleInventorySubmit(event)">
            <div class="row">
              <div>
                <label for="itemName">Item Name</label>
                <input id="itemName" type="text" required />
              </div>
              <div>
                <label for="itemQty">Quantity</label>
                <input id="itemQty" type="number" min="0" step="1" required />
              </div>
              <div>
                <label for="itemBuy">Buying Price</label>
                <input id="itemBuy" type="number" min="0" step="0.01" required />
              </div>
              <div>
                <label for="itemSell">Selling Price</label>
                <input id="itemSell" type="number" min="0" step="0.01" required />
              </div>
              <div>
                <label for="itemStorage">Storage</label>
                <input id="itemStorage" type="text" placeholder="e.g. Drawer A" required />
              </div>
            </div>
            <div class="flex-between mt-2">
              <button class="btn-primary" type="submit" id="itemSaveBtn">Save Item</button>
              <div class="tiny-text">
                Pag existing ang name, auto update para hindi mag double.
              </div>
            </div>
          </form>

          <!-- WINDOW STYLE INVENTORY LIST -->
          <div class="inventory-window mt-2">
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Qty</th>
                  <th>Buy</th>
                  <th>Sell</th>
                  <th>Storage</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="inventoryBody">
                <!-- items list -->
              </tbody>
            </table>
          </div>

          <div class="flex-between mt-2">
            <span class="tiny-text">Tip: Click "Edit" para baguhin ang item, hindi na dadami.</span>
            <button class="btn-danger btn-xs" type="button" onclick="clearAllInventory()">Reset Inventory</button>
          </div>
        </div>
      </div>

      <!-- RIGHT SIDE: SALES + EXPENSES + BACKUP -->
      <div class="right">
        <div class="card">
          <div class="section-title">Sales</div>
          <form id="salesForm" onsubmit="handleAddSale(event)">
            <div class="row-3">
              <div>
                <label for="saleItemName">Item Name</label>
                <input id="saleItemName" type="text" list="itemOptions" placeholder="Type item name..." required />
                <datalist id="itemOptions">
                  <!-- options from items -->
                </datalist>
              </div>
              <div>
                <label for="saleQty">Qty Sold</label>
                <input id="saleQty" type="number" min="1" step="1" required />
              </div>
              <div>
                <label>&nbsp;</label>
                <button class="btn-primary btn-block" type="submit">Add Sale</button>
              </div>
            </div>
            <div class="tiny-text" id="saleHint"></div>
          </form>

          <div class="scroll-window mt-2">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Item</th>
                  <th>Qty</th>
                  <th>Sell</th>
                  <th>Profit</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="salesBody">
                <!-- sales rows -->
              </tbody>
            </table>
          </div>

          <div class="flex-between mt-2">
            <span class="tiny-text">You can delete wrong sales entry.</span>
            <button class="btn-danger btn-xs" type="button" onclick="clearSalesHistory()">Clear Sales History</button>
          </div>
        </div>

        <div class="card mt-3">
          <div class="section-title">Expenses</div>
          <form id="expenseForm" onsubmit="handleAddExpense(event)">
            <div class="row-3">
              <div>
                <label for="expenseDesc">Description</label>
                <input id="expenseDesc" type="text" placeholder="Kuryente, renta, etc." required />
              </div>
              <div>
                <label for="expenseAmount">Amount</label>
                <input id="expenseAmount" type="number" min="0" step="0.01" required />
              </div>
              <div>
                <label>&nbsp;</label>
                <button class="btn-secondary btn-block" type="submit">Add Expense</button>
              </div>
            </div>
          </form>

          <div class="scroll-window mt-2">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Desc</th>
                  <th class="text-right">Amount</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="expenseBody">
                <!-- expenses -->
              </tbody>
            </table>
          </div>

          <div class="flex-between mt-2">
            <span class="tiny-text">Automatic minus sa profit ng sales.</span>
            <button class="btn-danger btn-xs" type="button" onclick="clearExpenses()">Clear Expenses</button>
          </div>
        </div>

        <div class="card mt-3">
          <div class="section-title">Backup &amp; Tools</div>
          <div class="row-3">
            <button class="btn-secondary" type="button" onclick="downloadBackup()">Download Backup</button>
            <label class="btn-secondary" style="text-align:center; cursor:pointer;">
              Import Backup
              <input type="file" id="backupFileInput" accept="application/json" style="display:none;" />
            </label>
            <button class="btn-danger" type="button" onclick="resetAllData()">Reset All Data</button>
          </div>
          <div class="tiny-text mt-2">
            Data is also saved automatically in this browser (localStorage).
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== DATA STORAGE =====
    let items = [];
    let sales = [];
    let expenses = [];
    let editingItemId = null;

    const STORAGE_KEY = "makoi_motor_shop_pos_v1";

    function getTodayString() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function formatMoney(num) {
      return "â‚±" + Number(num || 0).toFixed(2);
    }

    function saveToLocalStorage() {
      const data = { items, sales, expenses };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function loadFromLocalStorage() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        items = data.items || [];
        sales = data.sales || [];
        expenses = data.expenses || [];
      } catch (e) {
        console.error("Failed to load data:", e);
      }
    }

    // ===== INVENTORY =====
    function handleInventorySubmit(e) {
      e.preventDefault();
      const nameEl = document.getElementById("itemName");
      const qtyEl = document.getElementById("itemQty");
      const buyEl = document.getElementById("itemBuy");
      const sellEl = document.getElementById("itemSell");
      const storageEl = document.getElementById("itemStorage");

      const name = nameEl.value.trim();
      const qty = parseInt(qtyEl.value, 10) || 0;
      const buy = parseFloat(buyEl.value) || 0;
      const sell = parseFloat(sellEl.value) || 0;
      const storage = storageEl.value.trim();

      if (!name) return;

      if (editingItemId !== null) {
        const idx = items.findIndex(i => i.id === editingItemId);
        if (idx !== -1) {
          items[idx].name = name;
          items[idx].quantity = qty;
          items[idx].buyingPrice = buy;
          items[idx].sellingPrice = sell;
          items[idx].storage = storage;
        }
      } else {
        // check existing by name (case-insensitive)
        const existing = items.find(
          i => i.name.toLowerCase() === name.toLowerCase()
        );
        if (existing) {
          if (!confirm("Item already exists. Update this item?")) {
            return;
          }
          existing.quantity = qty;
          existing.buyingPrice = buy;
          existing.sellingPrice = sell;
          existing.storage = storage;
        } else {
          items.push({
            id: Date.now(),
            name,
            quantity: qty,
            buyingPrice: buy,
            sellingPrice: sell,
            storage
          });
        }
      }

      editingItemId = null;
      document.getElementById("itemSaveBtn").textContent = "Save Item";
      e.target.reset();
      saveToLocalStorage();
      renderItems();
      renderSearchOptions();
      renderSearchResults(); // refresh search window
    }

    function renderItems() {
      const tbody = document.getElementById("inventoryBody");
      tbody.innerHTML = "";

      items.forEach(item => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>${formatMoney(item.buyingPrice)}</td>
          <td>${formatMoney(item.sellingPrice)}</td>
          <td>${item.storage}</td>
          <td>
            <button class="btn-secondary btn-xs" type="button" onclick="editItem(${item.id})">Edit</button>
            <button class="btn-danger btn-xs" type="button" onclick="deleteItem(${item.id})">Del</button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    }

    function editItem(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      editingItemId = id;
      document.getElementById("itemName").value = item.name;
      document.getElementById("itemQty").value = item.quantity;
      document.getElementById("itemBuy").value = item.buyingPrice;
      document.getElementById("itemSell").value = item.sellingPrice;
      document.getElementById("itemStorage").value = item.storage;
      document.getElementById("itemSaveBtn").textContent = "Update Item";
    }

    function deleteItem(id) {
      if (!confirm("Are you sure?")) return;
      items = items.filter(i => i.id !== id);
      saveToLocalStorage();
      renderItems();
      renderSearchOptions();
      renderSearchResults();
    }

    function clearAllInventory() {
      if (!confirm("Are you sure you want to reset all inventory?")) return;
      items = [];
      editingItemId = null;
      document.getElementById("inventoryForm").reset();
      document.getElementById("itemSaveBtn").textContent = "Save Item";
      saveToLocalStorage();
      renderItems();
      renderSearchOptions();
      renderSearchResults();
    }

    // ===== SEARCH =====
    function handleSearch() {
      const term = document.getElementById("searchInput").value.trim().toLowerCase();
      renderSearchResults(term);
    }

    function clearSearch() {
      document.getElementById("searchInput").value = "";
      renderSearchResults("");
    }

    function renderSearchResults(term = "") {
      const tbody = document.getElementById("searchResultsBody");
      tbody.innerHTML = "";

      if (!term) {
        // walang laman pag walang search para hindi magulo tingnan
        return;
      }

      const filtered = items.filter(item =>
        item.name.toLowerCase().includes(term) ||
        (item.storage || "").toLowerCase().includes(term)
      );

      filtered.forEach(item => {
        const tr = document.createElement("tr");
        const unitProfit = (item.sellingPrice || 0) - (item.buyingPrice || 0);

        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>${formatMoney(item.buyingPrice)}</td>
          <td>${formatMoney(item.sellingPrice)}</td>
          <td>${formatMoney(unitProfit)}</td>
          <td>${item.storage}</td>
          <td>
            <button class="btn-secondary btn-xs" type="button" onclick="useItemForSale('${encodeURIComponent(item.name)}')">Use</button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    }

    function useItemForSale(encodedName) {
      const name = decodeURIComponent(encodedName);
      const input = document.getElementById("saleItemName");
      input.value = name;
      updateSaleHint();
      input.focus();
    }

    function renderSearchOptions() {
      const list = document.getElementById("itemOptions");
      list.innerHTML = "";
      items.forEach(item => {
        const opt = document.createElement("option");
        opt.value = item.name;
        list.appendChild(opt);
      });
    }

    // ===== SALES =====
    function updateSaleHint() {
      const name = document.getElementById("saleItemName").value.trim().toLowerCase();
      const hint = document.getElementById("saleHint");
      const item = items.find(i => i.name.toLowerCase() === name);
      if (!item) {
        hint.textContent = "Item not found in inventory.";
        return;
      }
      const unitProfit = (item.sellingPrice || 0) - (item.buyingPrice || 0);
      hint.textContent =
        `Stock: ${item.quantity} | Buy: ${formatMoney(item.buyingPrice)} | ` +
        `Sell: ${formatMoney(item.sellingPrice)} | Profit per pc: ${formatMoney(unitProfit)}`;
    }

    function handleAddSale(e) {
      e.preventDefault();
      const nameInput = document.getElementById("saleItemName");
      const qtyInput = document.getElementById("saleQty");

      const name = nameInput.value.trim();
      const qty = parseInt(qtyInput.value, 10) || 0;
      if (!name || qty <= 0) return;

      const item = items.find(i => i.name.toLowerCase() === name.toLowerCase());
      if (!item) {
        alert("Item not found in inventory.");
        return;
      }

      const selling = item.sellingPrice || 0;
      const buying = item.buyingPrice || 0;
      const unitProfit = selling - buying;
      const totalProfit = unitProfit * qty;
      const totalSalesAmount = selling * qty;

      // Update stock (optional)
      if (item.quantity - qty < 0) {
        if (!confirm("Quantity sold is higher than stock. Continue?")) {
          return;
        }
      } else {
        item.quantity -= qty;
      }

      sales.push({
        id: Date.now(),
        itemId: item.id,
        itemName: item.name,
        quantity: qty,
        sellingPrice: selling,
        totalSalesAmount,
        totalProfit,
        date: getTodayString()
      });

      saveToLocalStorage();
      renderItems();
      renderSales();
      updateSummary();

      e.target.reset();
      document.getElementById("saleHint").textContent = "";
    }

    function renderSales() {
      const tbody = document.getElementById("salesBody");
      tbody.innerHTML = "";

      sales.forEach(s => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${s.date}</td>
          <td>${s.itemName}</td>
          <td>${s.quantity}</td>
          <td>${formatMoney(s.sellingPrice)}</td>
          <td>${formatMoney(s.totalProfit)}</td>
          <td>
            <button class="btn-danger btn-xs" type="button" onclick="deleteSale(${s.id})">Del</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function deleteSale(id) {
      if (!confirm("Are you sure?")) return;
      sales = sales.filter(s => s.id !== id);
      saveToLocalStorage();
      renderSales();
      updateSummary();
    }

    function clearSalesHistory() {
      if (!confirm("Are you sure you want to delete ALL sales history?")) return;
      sales = [];
      saveToLocalStorage();
      renderSales();
      updateSummary();
    }

    // ===== EXPENSES =====
    function handleAddExpense(e) {
      e.preventDefault();
      const descEl = document.getElementById("expenseDesc");
      const amountEl = document.getElementById("expenseAmount");

      const desc = descEl.value.trim();
      const amt = parseFloat(amountEl.value) || 0;
      if (!desc || amt <= 0) return;

      expenses.push({
        id: Date.now(),
        description: desc,
        amount: amt,
        date: getTodayString()
      });

      saveToLocalStorage();
      renderExpenses();
      updateSummary();
      e.target.reset();
    }

    function renderExpenses() {
      const tbody = document.getElementById("expenseBody");
      tbody.innerHTML = "";

      expenses.forEach(exp => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${exp.date}</td>
          <td>${exp.description}</td>
          <td class="text-right">${formatMoney(exp.amount)}</td>
          <td>
            <button class="btn-danger btn-xs" type="button" onclick="deleteExpense(${exp.id})">Del</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function deleteExpense(id) {
      if (!confirm("Are you sure?")) return;
      expenses = expenses.filter(e => e.id !== id);
      saveToLocalStorage();
      renderExpenses();
      updateSummary();
    }

    function clearExpenses() {
      if (!confirm("Are you sure you want to delete ALL expenses?")) return;
      expenses = [];
      saveToLocalStorage();
      renderExpenses();
      updateSummary();
    }

    // ===== SUMMARY =====
    function updateSummary() {
      const today = getTodayString();
      let salesToday = 0;
      let profitToday = 0;
      let expensesToday = 0;

      sales.forEach(s => {
        if (s.date === today) {
          salesToday += s.totalSalesAmount || (s.sellingPrice * s.quantity);
          profitToday += s.totalProfit || 0;
        }
      });

      expenses.forEach(e => {
        if (e.date === today) {
          expensesToday += e.amount || 0;
        }
      });

      document.getElementById("summarySales").textContent = formatMoney(salesToday);
      document.getElementById("summaryProfit").textContent = formatMoney(profitToday);
      document.getElementById("summaryExpenses").textContent = formatMoney(expensesToday);
      document.getElementById("summaryNet").textContent = formatMoney(profitToday - expensesToday);
    }

    // ===== BACKUP =====
    function downloadBackup() {
      const data = { items, sales, expenses };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "makoi_motor_shop_backup.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function handleBackupImport(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          items = data.items || [];
          sales = data.sales || [];
          expenses = data.expenses || [];
          saveToLocalStorage();
          renderItems();
          renderSales();
          renderExpenses();
          renderSearchOptions();
          renderSearchResults();
          updateSummary();
          alert("Backup imported successfully.");
        } catch (err) {
          alert("Invalid backup file.");
        }
      };
      reader.readAsText(file);
    }

    function resetAllData() {
      if (!confirm("Are you sure you want to delete ALL data (inventory, sales, expenses)?")) return;
      items = [];
      sales = [];
      expenses = [];
      editingItemId = null;
      saveToLocalStorage();
      document.getElementById("inventoryForm").reset();
      document.getElementById("salesForm").reset();
      document.getElementById("expenseForm").reset();
      renderItems();
      renderSales();
      renderExpenses();
      renderSearchOptions();
      renderSearchResults();
      updateSummary();
    }

    // ===== INIT =====
    function init() {
      document.getElementById("todayLabel").textContent = getTodayString();

      loadFromLocalStorage();
      renderItems();
      renderSales();
      renderExpenses();
      renderSearchOptions();
      renderSearchResults();
      updateSummary();

      document.getElementById("searchInput").addEventListener("input", handleSearch);
      document.getElementById("saleItemName").addEventListener("input", updateSaleHint);
      document.getElementById("backupFileInput").addEventListener("change", function(e) {
        const file = e.target.files[0];
        if (file) handleBackupImport(file);
        e.target.value = "";
      });
    }

    window.addEventListener("load", init);
  </script>
</body>
  </html>
