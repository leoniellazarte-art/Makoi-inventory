<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Makoi Motor Shop POS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f4f5fb;
      --card: #ffffff;
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --danger: #dc2626;
      --success: #16a34a;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text-main);
    }

    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px 12px 40px;
    }

    header {
      margin-bottom: 16px;
    }

    header h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
    }

    header p {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--text-muted);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 12px;
    }

    @media (max-width: 800px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 12px;
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .card h2 {
      margin: 0 0 6px;
      font-size: 16px;
    }

    .card small {
      color: var(--text-muted);
      font-size: 12px;
    }

    .section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 500;
    }

    label {
      display: block;
      font-size: 12px;
      margin-bottom: 2px;
      color: var(--text-muted);
    }

    input,
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 13px;
      outline: none;
      background: #f9fafb;
    }

    input:focus,
    select:focus {
      border-color: var(--accent);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.1);
    }

    .row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .row-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }

    .mt-1 {
      margin-top: 4px;
    }

    .mt-2 {
      margin-top: 8px;
    }

    .mt-3 {
      margin-top: 12px;
    }

    .btn {
      padding: 7px 9px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .btn-icon {
      font-size: 14px;
    }

    .btn-group {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .pill-tabs {
      display: inline-flex;
      background: #f3f4f6;
      border-radius: 999px;
      padding: 3px;
      margin-top: 8px;
      gap: 2px;
    }

    .pill-tab {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      border: none;
      background: transparent;
      color: var(--text-muted);
    }

    .pill-tab.active {
      background: #fff;
      color: var(--accent);
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 11px;
    }

    th,
    td {
      padding: 6px 6px;
      text-align: left;
      border-bottom: 1px solid #eef0f4;
    }

    th {
      background: #f9fafb;
      font-size: 11px;
      color: var(--text-muted);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    .table-wrapper {
      max-height: 210px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #fff;
      margin-top: 6px;
    }

    .text-right {
      text-align: right;
    }

    .text-center {
      text-align: center;
    }

    .text-muted {
      color: var(--text-muted);
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .chip-danger {
      background: #fee2e2;
      color: #b91c1c;
    }

    .chip-success {
      background: #dcfce7;
      color: #16a34a;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 4px;
    }

    @media (max-width: 800px) {
      .summary-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .summary-card {
      padding: 8px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    .summary-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    .summary-value {
      font-size: 14px;
      font-weight: 700;
      margin-top: 2px;
    }

    .summary-sub {
      font-size: 11px;
      margin-top: 1px;
      color: var(--text-muted);
    }

    .search-box {
      margin-top: 8px;
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .search-box input {
      flex: 1;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      font-size: 10px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
      margin-left: 4px;
    }

    .link {
      font-size: 11px;
      color: var(--accent);
      text-decoration: underline;
      cursor: pointer;
    }

    .footer-note {
      margin-top: 8px;
      font-size: 10px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Makoi Motor Shop POS</h1>
      <p>
        Simple inventory &amp; POS for motor parts â€“
        <strong>may auto profit at daily sales summary</strong>.
      </p>
    </header>

    <div class="grid">
      <!-- INVENTORY -->
      <section class="card">
        <div class="section-title">
          <div>
            <h2>Inventory</h2>
            <small
              >No. of items, item name, buying price, stock &amp; storage
              location.</small
            >
          </div>
          <span class="badge">Step 1: Encode items</span>
        </div>

        <div class="mt-2">
          <label for="itemName">Item name / description</label>
          <input
            id="itemName"
            placeholder="e.g. Saiyan Rocker Arm TMX155 Upper"
            autocomplete="off"
          />
        </div>

        <div class="row mt-2">
          <div>
            <label for="itemBuy">Buying price (per pc)</label>
            <input id="itemBuy" type="number" min="0" step="1" />
          </div>
          <div>
            <label for="itemSell">Selling price (per pc)</label>
            <input id="itemSell" type="number" min="0" step="1" />
          </div>
        </div>

        <div class="row mt-2">
          <div>
            <label for="itemStock">Remaining stock (pcs)</label>
            <input id="itemStock" type="number" min="0" step="1" />
          </div>
          <div>
            <label for="itemStorage">Storage box / location</label>
            <input
              id="itemStorage"
              placeholder="(iwan mong blank, bro â€“ ikaw na maglalagay)"
            />
          </div>
        </div>

        <div class="btn-group">
          <button id="saveItemBtn" class="btn btn-primary">
            <span class="btn-icon">ðŸ’¾</span> Save item
          </button>
          <button id="resetItemBtn" class="btn btn-secondary">
            âŸ³ Reset fields
          </button>
          <button id="clearAllBtn" class="btn btn-danger">
            ðŸ—‘ Clear all data
          </button>
        </div>

        <div class="search-box">
          <input
            id="searchInput"
            placeholder="Search item name or storage locationâ€¦"
          />
          <span class="tag">Inventory list</span>
        </div>

        <div class="table-wrapper" id="itemsTableWrapper">
          <table>
            <thead>
              <tr>
                <th class="text-center">#</th>
                <th>Item</th>
                <th class="text-right">Buy</th>
                <th class="text-right">Sell</th>
                <th class="text-center">Stock</th>
                <th>Storage</th>
                <th class="text-right">Value</th>
              </tr>
            </thead>
            <tbody id="itemsTbody"></tbody>
          </table>
        </div>

        <div class="summary-grid mt-2">
          <div class="summary-card">
            <div class="summary-label">Total items</div>
            <div id="totalItems" class="summary-value">0</div>
            <div class="summary-sub">Unique item names</div>
          </div>
          <div class="summary-card">
            <div class="summary-label">Inventory cost (buy)</div>
            <div id="inventoryCost" class="summary-value">â‚±0</div>
            <div class="summary-sub">Sum of buy Ã— stock</div>
          </div>
          <div class="summary-card">
            <div class="summary-label">Inventory value (sell)</div>
            <div id="inventoryValue" class="summary-value">â‚±0</div>
            <div class="summary-sub">Sum of sell Ã— stock</div>
          </div>
        </div>

        <p class="footer-note">
          Tip: kapag mag-eedit ng lumang item, i-type mo ulit ang pangalan,
          babaguhin ang presyo o stock, tapos ulit i-click ang <b>Save item</b>.
        </p>
      </section>

      <!-- SALES & SUMMARY -->
      <section class="card">
        <div class="section-title">
          <div>
            <h2>Sales &amp; Profit</h2>
            <small>Record sales, auto-compute profit &amp; daily total.</small>
          </div>
          <span class="badge">Step 2: Record sales</span>
        </div>

        <!-- RECORD SALE -->
        <div class="mt-1">
          <label for="saleItem">Select item</label>
          <select id="saleItem">
            <option value="">-- choose item --</option>
          </select>
        </div>

        <div class="row mt-2">
          <div>
            <label for="saleQty">Quantity (pcs)</label>
            <input id="saleQty" type="number" min="1" value="1" />
          </div>
          <div>
            <label for="saleSellPrice"
              >Selling price (auto from item, pwede i-edit)</label
            >
            <input id="saleSellPrice" type="number" min="0" step="1" />
          </div>
        </div>

        <div class="row mt-2">
          <div>
            <label>Buying price (per pc)</label>
            <input id="saleBuyPrice" type="number" disabled />
          </div>
          <div>
            <label>Profit for this sale</label>
            <input id="saleProfit" type="text" disabled />
          </div>
        </div>

        <div class="row mt-2">
          <div>
            <label for="saleTotal">Total amount</label>
            <input id="saleTotal" type="text" disabled />
          </div>
          <div>
            <label for="saleDate">Date</label>
            <input id="saleDate" type="date" />
          </div>
        </div>

        <div class="btn-group">
          <button id="saveSaleBtn" class="btn btn-primary">
            âœ… Save sale
          </button>
          <button id="resetSaleBtn" class="btn btn-secondary">
            âŸ³ Reset sale
          </button>
        </div>

        <!-- DAILY SUMMARY -->
        <div class="pill-tabs">
          <button id="tabToday" class="pill-tab active">Today</button>
          <button id="tabAll" class="pill-tab">All time</button>
        </div>

        <div class="summary-grid mt-2">
          <div class="summary-card">
            <div class="summary-label">
              <span id="summaryLabel">Today sales</span>
            </div>
            <div id="summarySales" class="summary-value">â‚±0</div>
            <div class="summary-sub" id="summarySalesSub">
              Total amount of sales
            </div>
          </div>
          <div class="summary-card">
            <div class="summary-label">
              <span id="summaryProfitLabel">Today profit</span>
            </div>
            <div id="summaryProfit" class="summary-value">â‚±0</div>
            <div class="summary-sub">Sales â€“ cost (buy)</div>
          </div>
          <div class="summary-card">
            <div class="summary-label">Recorded expenses</div>
            <div id="summaryExpenses" class="summary-value">â‚±0</div>
            <div class="summary-sub">For net profit computation</div>
          </div>
        </div>

        <div class="mt-3">
          <span class="summary-label">Recent sales</span>
          <span class="link" id="clearSalesLink">clear all sales</span>
          <div class="table-wrapper" style="max-height: 150px">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Item</th>
                  <th class="text-center">Qty</th>
                  <th class="text-right">Total</th>
                  <th class="text-right">Profit</th>
                </tr>
              </thead>
              <tbody id="salesTbody"></tbody>
            </table>
          </div>
        </div>

        <!-- EXPENSES -->
        <div class="mt-3">
          <span class="summary-label">Add expense</span>
          <div class="row mt-1">
            <div>
              <label for="expDesc">Description</label>
              <input
                id="expDesc"
                placeholder="e.g. kuryente, renta, sweldo"
              />
            </div>
            <div>
              <label for="expAmount">Amount</label>
              <input id="expAmount" type="number" min="0" step="1" />
            </div>
          </div>
          <div class="row mt-1">
            <div>
              <label for="expDate">Date</label>
              <input id="expDate" type="date" />
            </div>
            <div style="display: flex; align-items: flex-end; gap: 6px">
              <button id="saveExpBtn" class="btn btn-primary" style="width:100%">
                ðŸ’¸ Save expense
              </button>
            </div>
          </div>

          <div class="table-wrapper" style="max-height: 120px; margin-top: 8px">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th class="text-right">Amount</th>
                </tr>
              </thead>
              <tbody id="expensesTbody"></tbody>
            </table>
          </div>
        </div>

        <p class="footer-note">
          Lahat ng data naka-save lang sa cellphone mo gamit browser storage.
          Kung lilinis ka ulit, gamitin ang <b>Clear all data</b> sa inventory.
        </p>
      </section>
    </div>
  </div>

  <script>
    // ===== BASIC HELPERS =====
    const formatMoney = (n) =>
      "â‚±" +
      (Number(n) || 0)
        .toLocaleString("en-PH", {
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        });

    const todayISO = () => new Date().toISOString().slice(0, 10);

    // ===== STORAGE KEYS =====
    const STORAGE_ITEMS = "makoi_pos_items_v2";
    const STORAGE_SALES = "makoi_pos_sales_v2";
    const STORAGE_EXPENSES = "makoi_pos_expenses_v2";

    // ===== INITIAL SEED ITEMS (sample lang, pwede mong dagdagan) =====
    const seedItems = [
      // galing sa quotation form â€“ sample
      {
        id: 1,
        name: "Saiyan Rocker Arm TMX155 Upper",
        buyPrice: 420,
        sellPrice: 480,
        stock: 3,
        storage: "",
      },
      {
        id: 2,
        name: "Saiyan Rocker Arm TMX155 Cam Follower",
        buyPrice: 280,
        sellPrice: 345,
        stock: 3,
        storage: "",
      },
      {
        id: 3,
        name: "OD Battery 12NSL",
        buyPrice: 900,
        sellPrice: 1200,
        stock: 3,
        storage: "",
      },
      {
        id: 4,
        name: "Zeno Brake Pad Click150",
        buyPrice: 120,
        sellPrice: 210,
        stock: 3,
        storage: "",
      },
      {
        id: 5,
        name: "Saiyan Engine Valve XRM110",
        buyPrice: 150,
        sellPrice: 250,
        stock: 3,
        storage: "",
      },
    ];

    // ===== STATE =====
    let items = [];
    let sales = [];
    let expenses = [];
    let currentTab = "today"; // "today" or "all"

    // ===== LOAD / SAVE =====
    function loadState() {
      try {
        const itemsRaw = localStorage.getItem(STORAGE_ITEMS);
        const salesRaw = localStorage.getItem(STORAGE_SALES);
        const expRaw = localStorage.getItem(STORAGE_EXPENSES);

        if (!itemsRaw) {
          items = seedItems;
          saveItems();
        } else {
          items = JSON.parse(itemsRaw) || [];
        }

        sales = salesRaw ? JSON.parse(salesRaw) : [];
        expenses = expRaw ? JSON.parse(expRaw) : [];
      } catch (e) {
        console.error("Error loading state", e);
        items = seedItems;
        sales = [];
        expenses = [];
      }
    }

    function saveItems() {
      localStorage.setItem(STORAGE_ITEMS, JSON.stringify(items));
    }

    function saveSales() {
      localStorage.setItem(STORAGE_SALES, JSON.stringify(sales));
    }

    function saveExpenses() {
      localStorage.setItem(STORAGE_EXPENSES, JSON.stringify(expenses));
    }

    // ===== INVENTORY RENDERING =====
    const itemNameInput = document.getElementById("itemName");
    const itemBuyInput = document.getElementById("itemBuy");
    const itemSellInput = document.getElementById("itemSell");
    const itemStockInput = document.getElementById("itemStock");
    const itemStorageInput = document.getElementById("itemStorage");
    const itemsTbody = document.getElementById("itemsTbody");
    const totalItemsEl = document.getElementById("totalItems");
    const inventoryCostEl = document.getElementById("inventoryCost");
    const inventoryValueEl = document.getElementById("inventoryValue");
    const searchInput = document.getElementById("searchInput");

    function renderItems() {
      const q = (searchInput.value || "").toLowerCase();
      let rows = "";
      let totalCost = 0;
      let totalValue = 0;

      const filtered = items.filter((it) => {
        if (!q) return true;
        return (
          it.name.toLowerCase().includes(q) ||
          (it.storage || "").toLowerCase().includes(q)
        );
      });

      filtered.forEach((it, idx) => {
        const value = (Number(it.sellPrice) || 0) * (Number(it.stock) || 0);
        const cost = (Number(it.buyPrice) || 0) * (Number(it.stock) || 0);
        totalCost += cost;
        totalValue += value;

        rows += `
          <tr data-name="${it.name.replace(/"/g, "&quot;")}">
            <td class="text-center">${idx + 1}</td>
            <td>${it.name}</td>
            <td class="text-right">${formatMoney(it.buyPrice)}</td>
            <td class="text-right">${formatMoney(it.sellPrice)}</td>
            <td class="text-center">${it.stock}</td>
            <td>${it.storage || ""}</td>
            <td class="text-right">${formatMoney(value)}</td>
          </tr>
        `;
      });

      itemsTbody.innerHTML = rows || `
        <tr><td colspan="7" class="text-center text-muted">No items yet.</td></tr>
      `;
      totalItemsEl.textContent = items.length;
      inventoryCostEl.textContent = formatMoney(totalCost);
      inventoryValueEl.textContent = formatMoney(totalValue);

      // update sale item select
      renderSaleItemOptions();
    }

    function clearItemForm() {
      itemNameInput.value = "";
      itemBuyInput.value = "";
      itemSellInput.value = "";
      itemStockInput.value = "";
      itemStorageInput.value = "";
      itemNameInput.focus();
    }

    function onSaveItem() {
      const name = itemNameInput.value.trim();
      const buy = Number(itemBuyInput.value || 0);
      const sell = Number(itemSellInput.value || 0);
      const stock =
